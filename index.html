<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Волшебное поздравление</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        /* ОБЩИЕ СТИЛИ */
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        
        .scene-container {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            opacity: 0;
            transition: opacity 1.5s ease;
            pointer-events: none;
            overflow: hidden;
        }
        
        .scene-container.active {
            opacity: 1;
            pointer-events: all;
            z-index: 10;
        }
        
        .global-click-hint {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.9);
            font-size: 16px;
            text-align: center;
            animation: pulse 2s infinite;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.8);
            z-index: 100;
            pointer-events: none;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        
        @keyframes gentleFlash {
            0%, 100% { 
                filter: brightness(1);
            }
            50% { 
                filter: brightness(1.3);
            }
        }
        
        .click-hint {
            display: none;
        }
        
        .wand-in-sunrise {
            position: absolute;
            bottom: 100px;
            right: 100px;
            z-index: 20;
            transform:rotate(-15deg) scale(0.7);
            animation: wandAppear 2s ease-in-out forwards;
        }
        
        @keyframes wandAppear {
            0% { opacity: 0; transform: scale(0.7) translateY(50px); }
            100% { opacity: 1; transform: scale(0.7) translateY(0); }
        }

        /* СТИЛИ ДЛЯ РАССВЕТА */
        .sky {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, 
                #00008b 0%, 
                #1a1a7a 15%,
                #4a0080 30%,
                #8b008b 45%,
                #ff4500 60%,
                #ff8c00 75%,
                #ffd700 90%,
                #ffffff 100%);
        }
        
        .stars {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        
        .star {
            position: absolute;
            background: #ffffff;
            border-radius: 50%;
            animation: twinkle 3s infinite ease-in-out;
        }
        
        @keyframes twinkle {
            0%, 100% { 
                opacity: 0.8;
                transform: scale(1);
            }
            50% { 
                opacity: 0.3;
                transform: scale(0.8);
            }
        }
        
        .sun-container {
            position: absolute;
            width: 300px;
            height: 300px;
            left: 50%;
            bottom: -150px;
            transform: translateX(-50%);
            animation: sunrise 8s ease-out forwards;
        }
        
        @keyframes sunrise {
            0% { 
                bottom: -150px;
            }
            100% { 
                bottom: calc(70% - 150px);
            }
        }
        
        .rays {
            position: absolute;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        .ray {
            position: absolute;
            background: linear-gradient(to top, 
                rgba(255, 215, 0, 0.6),
                rgba(255, 215, 0, 0));
            width: 50px;
            height: 250px;
            left: 50%;
            bottom: 150px;
            transform: translateX(-50%) rotate(var(--rotation));
            transform-origin: bottom center;
            border-radius: 12px;
            animation: rayGlow 6s infinite alternate;
            filter: blur(2px);
        }
        
        @keyframes rayGlow {
            0% { opacity: 0.4; }
            100% { opacity: 0.8; }
        }
        
        .sun {
            position: absolute;
            width: 120px;
            height: 120px;
            background: radial-gradient(circle, 
                #ffd700 0%,
                #ff8c00 30%,
                #ff4500 60%,
                #ff0000 80%);
            border-radius: 50%;
            left: 50%;
            bottom: 90px;
            transform: translateX(-50%);
            box-shadow: 
                0 0 80px #ffd700,
                0 0 160px rgba(255, 215, 0, 0.6),
                0 0 240px rgba(255, 140, 0, 0.4);
            z-index: 2;
            animation: sunGlow 4s infinite alternate;
        }
        
        @keyframes sunGlow {
            0% { 
                box-shadow: 
                    0 0 70px #ffd700,
                    0 0 140px rgba(255, 215, 0, 0.5),
                    0 0 210px rgba(255, 140, 0, 0.3);
            }
            100% { 
                box-shadow: 
                    0 0 90px #ffd700,
                    0 0 180px rgba(255, 215, 0, 0.7),
                    0 0 270px rgba(255, 140, 0, 0.5);
            }
        }
        
        .water {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 100px;
            background: linear-gradient(to top, 
                rgba(0, 0, 139, 0.7),
                rgba(25, 25, 112, 0.5),
                transparent);
            z-index: 2;
        }
        
        .fade-stars {
            animation: fadeStars 8s ease-out forwards;
        }
        
        @keyframes fadeStars {
            0% { opacity: 1; }
            100% { opacity: 0; }
        }

        /* СТИЛИ ДЛЯ ВОЛШЕБНОЙ ПАЛОЧКИ */
        .magic-wand {
            position: relative;
            width: 40px;
            height: 300px;
            cursor: pointer;
            transition: all 0.3s ease;
            transform-origin: center bottom;
        }

        .wand-handle {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 35px;
            height: 80px;
            background: linear-gradient(to top, 
                #8B4513 0%,
                #A0522D 30%,
                #CD853F 60%,
                #D2691E 100%);
            border-radius: 8px 8px 0 0;
            box-shadow: 0 0 15px rgba(139, 69, 19, 0.8);
        }

        .wand-stick {
            position: absolute;
            bottom: 75px;
            left: 50%;
            transform: translateX(-50%);
            width: 12px;
            height: 200px;
            background: linear-gradient(to top, 
                #DAA520 0%,
                #FFD700 30%,
                #FFEC8B 60%,
                #FFFFFF 90%);
            border-radius: 6px;
        }

        .wand-tip {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, 
                #FFFFFF 0%,
                #FFD700 50%,
                #FFA500 100%);
            border-radius: 50%;
            box-shadow: 0 0 25px rgba(255, 215, 0, 1);
            z-index: 2;
        }

        .wand-glow {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: radial-gradient(circle, 
                rgba(255, 215, 0, 0.8) 0%,
                rgba(255, 215, 0, 0.4) 50%,
                transparent 70%);
            animation: tipGlow 1.5s infinite alternate;
            pointer-events: none;
        }

        @keyframes tipGlow {
            0% { opacity: 0.6; transform: translateX(-50%) scale(0.8); }
            100% { opacity: 1; transform: translateX(-50%) scale(1.2); }
        }

        .magic-wand:hover {
            transform: scale(1.05);
        }

        .magic-wand:hover .wand-tip {
            box-shadow: 0 0 35px rgba(255, 215, 0, 1.2);
        }

        .magic-wand:active {
            transform:rotate(-15deg) scale(0.7);
            transition: all 0.2s ease;
        }

        .spark {
            position: absolute;
            pointer-events: none;
            animation: sparkFly 1.5s ease-out forwards;
        }

        @keyframes sparkFly {
            0% {
                opacity: 0;
                transform: translate(var(--startX), var(--startY)) scale(0) rotate(0deg);
            }
            20% {
                opacity: 1;
                transform: translate(var(--midX), var(--midY)) scale(1) rotate(var(--rotate));
            }
            80% {
                opacity: 0.8;
            }
            100% {
                opacity: 0;
                transform: translate(var(--endX), var(--endY)) scale(0.3) rotate(var(--rotateEnd));
            }
        }

        @keyframes wandMagic {
            0% {
                transform: rotate(0deg) scale(1);
                filter: brightness(1);
            }
            50% {
                transform: rotate(30deg) scale(1.1);
                filter: brightness(2);
            }
            100% {
                transform: rotate(0deg) scale(1);
                filter: brightness(1);
            }
        }

        /* СТИЛИ ДЛЯ КОФЕ С БЕЗЕ (из Coffe.html) */
        .coffee-scene-container {
            background: linear-gradient(to bottom, #FFE4B5, #FFFACD);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .scene {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            transform: scale(1.6);
        }

        /* Кружка с кофе - полностью переделана */
        .coffee-cup {
            position: relative;
            width: 120px;
            height: 150px;
            margin-bottom: 20px;
        }
        
        .cup {
            position: absolute;
            width: 210px;
            height: 180px;
            background: linear-gradient(135deg, #f0f0f0 0%, #ffffff 50%, #f0f0f0 100%);
            border-radius: 10px 10px 20px 20px;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 
                0 5px 15px rgba(0,0,0,0.2),
                inset 0 -3px 8px rgba(0,0,0,0.1);
        }
        
        .coffee {
            position: absolute;
            width: 165px;
            height: 140px;
            background: linear-gradient(to bottom, #4E3524, #5C3A21);
            border-radius: 8px 8px 18px 18px;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            overflow: hidden;
        }
        
        .coffee-surface {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 15px;
            background: linear-gradient(to right, 
                rgba(210, 105, 30, 0.9),
                rgba(160, 82, 45, 0.95),
                rgba(210, 105, 30, 0.9));
            border-radius: 8px 8px 0 0;
        }
        
        .coffee-foam {
            position: absolute;
            top: -4px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 18px;
            background: linear-gradient(to bottom, 
                rgba(205, 133, 63, 0.95),
                rgba(160, 82, 45, 0.85));
            border-radius: 50%;
            animation: foamBubble 3s infinite ease-in-out;
        }
        
        @keyframes foamBubble {
            0%, 100% { transform: translateX(-50%) translateY(0) scale(1); }
            50% { transform: translateX(-50%) translateY(-3px) scale(1.08); }
        }
        
        .handle {
            position: absolute;
            width: 80px;
            height: 110px;
            border: 12px solid #f0f0f0;
            border-left: none;
            border-radius: 0 50% 50% 0;
            right: -130px;
            top: 0px;
            box-shadow: 2px 0 8px rgba(0,0,0,0.15);
        }
        
        .steam {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .steam-cloud {
            position: absolute;
            width: 20px;
            height: 30px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            animation: steamRise 4s infinite ease-in-out;
            filter: blur(3px);
        }
        
        .steam-cloud:nth-child(1) {
            left: -15px;
            animation-delay: 0s;
        }
        
        .steam-cloud:nth-child(2) {
            left: 0;
            animation-delay: 1.2s;
        }
        
        .steam-cloud:nth-child(3) {
            left: 15px;
            animation-delay: 2.4s;
        }
        
        @keyframes steamRise {
            0% { 
                transform: translateY(0) scale(0.8);
                opacity: 0;
            }
            50% { 
                opacity: 0.8;
            }
            100% { 
                transform: translateY(-60px) scale(1.3);
                opacity: 0;
            }
        }
        
        /* Тарелка с безе - исправлено расположение */
        .meringue-plate {
            position: relative;
            width: 480px;
            height: 150px;
            margin-bottom: 10px;
        }
        
        .plate {
            position: absolute;
            width: 250px;
            height: 80px;
            background: linear-gradient(to bottom, #ffffff, #f0f0f0);
            border-radius: 50%;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 
                0 6px 20px rgba(0,0,0,0.2),
                inset 0 3px 8px rgba(255,255,255,0.9);
        }
        
        .meringues {
            position: absolute;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 5px;
            width: 240px;
        }
        
        .meringue {
            position: relative;
            background: linear-gradient(to bottom, #ffffff, #f8f8f8);
            border-radius: 50%;
            box-shadow: 
                0 4px 15px rgba(0,0,0,0.12),
                0 0 8px rgba(255,255,255,0.6);
            animation: meringueFloat 4s infinite ease-in-out;
        }
        
        /* Три больших безе ближе друг к другу */
        .meringue:nth-child(1) {
            width: 85px;
            height: 85px;
            animation-delay: 0s;
        }
        
        .meringue:nth-child(2) {
            width: 85px;
            height: 85px;
            animation-delay: 1.3s;
        }
        
        .meringue:nth-child(3) {
            width: 85px;
            height: 85px;
            animation-delay: 2.6s;
        }
        
        .meringue-top {
            position: absolute;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 50%;
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
        }
        
        .meringue:nth-child(1) .meringue-top {
            width: 50px;
            height: 30px;
            top: -6px;
            left: 10px;
        }
        
        .meringue:nth-child(2) .meringue-top {
            width: 50px;
            height: 30px;
            top: -8px;
            left: 12px;
        }
        
        .meringue:nth-child(3) .meringue-top {
            width: 50px;
            height: 30px;
            top: -5px;
            left: 11px;
        }
        
        @keyframes meringueFloat {
            0%, 100% { 
                transform: translateY(0) rotate(0deg);
            }
            33% { 
                transform: translateY(-6px) rotate(-1deg);
            }
            66% { 
                transform: translateY(-3px) rotate(1deg);
            }
        }
        
        /* Анимация появления */
        .coffee-cup {
            animation: slideInLeft 2s ease-out;
        }
        
        .meringue-plate {
            animation: slideInRight 2s ease-out 0.3s both;
        }
        
        @keyframes slideInLeft {
            0% { 
                transform: translateX(-100px);
                opacity: 0;
            }
            100% { 
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideInRight {
            0% { 
                transform: translateX(100px);
                opacity: 0;
            }
            100% { 
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* СТИЛИ ДЛЯ ЗОЛОТОЙ РЫБКИ */
        .aquarium {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background: linear-gradient(to bottom, #87CEEB, #1E90FF);
        }

        .goldfish {
            position: absolute;
            top: 50%;
            left: 50%;
            transform-origin: center;
            z-index: 10;
            transition: transform 0.5s ease;
        }

        .fish-body {
            position: relative;
            width: 150px;
            height: 60px;
            background: linear-gradient(45deg, 
                #FFD700 0%, 
                #FFEC8B 25%, 
                #FFA500 50%, 
                #FF8C00 75%, 
                #FF4500 100%);
            border-radius: 50% 40% 40% 50%;
            box-shadow: 
                0 0 20px rgba(255, 215, 0, 0.6),
                0 0 30px rgba(255, 165, 0, 0.4),
                inset -5px 0 15px rgba(255, 255, 255, 0.3);
            transform-origin: center;
        }

        .fish-tail {
            position: absolute;
            left: -80px;
            top: 50%;
            transform: translateY(-50%);
            width: 100px;
            height: 180px;
            background: linear-gradient(135deg, 
                rgba(255, 215, 0, 0.9) 0%,
                rgba(255, 165, 0, 0.85) 25%,
                rgba(255, 140, 0, 0.8) 50%,
                rgba(255, 99, 71, 0.75) 75%,
                rgba(255, 69, 0, 0.7) 100%);
            clip-path: path('M0,0 C40,20 70,60 0,90 C70,120 40,160 0,180 L80,90 Z');
            animation: tailMove 1.5s infinite alternate ease-in-out;
            transform-origin: right center;
            z-index: 1;
            box-shadow: 
                0 0 50px rgba(255, 69, 0, 0.8),
                0 0 30px rgba(255, 215, 0, 0.6),
                inset -10px 0 20px rgba(255, 255, 255, 0.4);
            filter: blur(2px) brightness(1.2);
        }

        @keyframes tailMove {
            0% {
                transform: translateY(-50%) rotate(-35deg) scale(0.95);
                filter: blur(2px) brightness(1.1) hue-rotate(-5deg);
            }
            50% {
                transform: translateY(-50%) rotate(0deg) scale(1.05);
                filter: blur(3px) brightness(1.3) hue-rotate(5deg);
            }
            100% {
                transform: translateY(-50%) rotate(35deg) scale(1);
                filter: blur(2px) brightness(1.2) hue-rotate(0deg);
            }
        }

        .fish-fin-top {
            position: absolute;
            top: -40px;
            left: 30px;
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, #FF4500, #FF6347, #FF8C00);
            clip-path: polygon(0% 0%, 100% 0%, 50% 100%, 25% 80%);
            animation: finMove 0.8s infinite alternate ease-in-out;
            transform-origin: bottom center;
            z-index: 3;
        }

        .fish-fin-bottom {
            position: absolute;
            bottom: -40px;
            left: 35px;
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, #FF4500, #FF6347, #FF8C00);
            clip-path: polygon(0% 100%, 100% 100%, 50% 0%, 25% 20%);
            animation: finMove 0.7s infinite alternate ease-in-out;
            transform-origin: top center;
            z-index: 3;
        }

        .fish-eye {
            position: absolute;
            right: 20px;
            top: 15px;
            width: 18px;
            height: 18px;
            background: black;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
            z-index: 4;
        }

        .eye-sparkle {
            position: absolute;
            top: 2px;
            right: 2px;
            width: 6px;
            height: 6px;
            background: white;
            border-radius: 50%;
        }

        .scales-container {
            position: absolute;
            width: 100%;
            height: 100%;
            z-index: 2;
        }

        .scale {
            position: absolute;
            width: 12px;
            height: 12px;
            background: radial-gradient(circle, #FFD700 30%, #FFA500 70%, #FF8C00 100%);
            border-radius: 50%;
            box-shadow: 
                0 0 8px rgba(255, 215, 0, 0.6),
                inset 0 0 4px rgba(255, 255, 255, 0.5);
            animation: scaleShine 3s infinite alternate;
        }

        .scale-1 { top: 20px; left: 30px; animation-delay: 0s; }
        .scale-2 { top: 25px; left: 45px; animation-delay: 0.3s; }
        .scale-3 { top: 15px; left: 60px; animation-delay: 0.6s; }
        .scale-4 { top: 30px; left: 75px; animation-delay: 0.9s; }
        .scale-5 { top: 22px; left: 90px; animation-delay: 1.2s; }

        @keyframes scaleShine {
            0% { opacity: 0.7; transform: scale(1); }
            100% { opacity: 1; transform: scale(1.1); filter: brightness(1.3); }
        }

        @keyframes finMove {
            0% {
                transform: rotate(-8deg) scaleY(0.9);
            }
            100% {
                transform: rotate(8deg) scaleY(1.1);
            }
        }

        .bubble {
            position: absolute;
            bottom: -50px;
            width: 80px;
            height: 80px;
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.8), rgba(173, 216, 230, 0.5));
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 12px;
            color: #333;
            font-weight: bold;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            animation: bubbleRise linear forwards;
            z-index: 5;
            cursor: pointer;
        }

        @keyframes bubbleRise {
            0% {
                transform: translateY(0) scale(0.5);
                opacity: 0.7;
            }
            70% {
                opacity: 0.8;
            }
            100% {
                transform: translateY(-110vh) scale(1.2);
                opacity: 0;
            }
        }

        .speech-bubble {
            position: absolute;
            top: -60px;
            right: -10px;
            background: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 14px;
            color: #333;
            opacity: 0;
            transition: opacity 0.5s;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 20;
            pointer-events: none;
        }

        .speech-bubble:after {
            content: '';
            position: absolute;
            top: 100%;
            right: 15px;
            border: 10px solid transparent;
            border-top-color: white;
        }

        /* СТИЛИ ДЛЯ ФЕЙЕРВЕРКА */
        .start-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px 40px;
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(45deg, #ff6b6b, #ff4757, #ff3838);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 
                0 0 30px rgba(255, 107, 107, 0.6),
                0 0 60px rgba(255, 71, 87, 0.4);
            transition: all 0.3s ease;
            z-index: 2;
            animation: pulse 2s infinite;
        }

        .start-btn:hover {
            transform: translate(-50%, -50%) scale(1.1);
            box-shadow: 
                0 0 40px rgba(255, 107, 107, 0.8),
                0 0 80px rgba(255, 71, 87, 0.6);
        }

        .hidden {
            display: none;
        }

        #fireworkCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        #sunriseScene .scene {
        transform: translateY(50px) scale(1.1);
    }
    </style>
</head>
<body>
    <!-- Аудио элемент для фоновой музыки -->
    <audio id="backgroundMusic" loop preload="auto"> 
        <source src="sound_for_video.mp3" type="audio/mp3"> 
    </audio>

    <!-- Сцена 1: Рассвет с палочкой -->
    <div id="sunriseScene" class="scene-container active">
        <div class="scene">
            <div class="sky"></div>
            
            <div class="stars" id="stars"></div>
            
            <div class="sun-container" id="sunContainer">
                <div class="rays" id="rays"></div>
                <div class="sun"></div>
            </div>
            
            <div class="water"></div>
        </div>
        
        <!-- Палочка в сцене рассвета -->
        <div class="wand-in-sunrise">
            <div class="magic-wand" id="magicWandSunrise">
                <div class="wand-handle"></div>
                <div class="wand-stick"></div>
                <div class="wand-tip"></div>
                <div class="wand-glow"></div>
            </div>
        </div>
        
        <div class="global-click-hint">Коснитесь волшебной палочки</div>
        <audio id="wandSound" src="Stick.mp3" preload="auto"></audio>
    </div>

    <!-- Сцена 2: Кофе с безе -->
    <div id="coffeeScene" class="scene-container coffee-scene-container">
        <div class="scene">
            <!-- Тарелка с безе СЛЕВА -->
            <div class="meringue-plate">
                <div class="plate"></div>
                <div class="meringues">
                    <div class="meringue">
                        <div class="meringue-top"></div>
                    </div>
                    <div class="meringue">
                        <div class="meringue-top"></div>
                    </div>
                    <div class="meringue">
                        <div class="meringue-top"></div>
                    </div>
                </div>
            </div>

            <!-- Кружка с кофе СПРАВА -->
            <div class="coffee-cup">
                <div class="cup"></div>
                <div class="coffee">
                    <div class="coffee-surface"></div>
                    <div class="coffee-foam"></div>
                </div>
                <div class="handle"></div>
                <div class="steam">
                    <div class="steam-cloud"></div>
                    <div class="steam-cloud"></div>
                    <div class="steam-cloud"></div>
                </div>
            </div>
        </div>
        
        <!-- Палочка в сцене кофе -->
        <div class="wand-in-sunrise" style="bottom: 80px; right: 80px;">
            <div class="magic-wand" id="magicWandCoffee">
                <div class="wand-handle"></div>
                <div class="wand-stick"></div>
                <div class="wand-tip"></div>
                <div class="wand-glow"></div>
            </div>
        </div>
        
        <div class="global-click-hint">Коснитесь волшебной палочки</div>
    </div>

    <!-- Сцена 3: Золотая рыбка -->
    <div id="fishScene" class="scene-container">
        <div class="aquarium">
            <div class="goldfish">
                <div class="fish-body">
                    <!-- Хвост -->
                    <div class="fish-tail"></div>
                    
                    <!-- Чешуйки -->
                    <div class="scales-container">
                        <div class="scale scale-1"></div>
                        <div class="scale scale-2"></div>
                        <div class="scale scale-3"></div>
                        <div class="scale scale-4"></div>
                        <div class="scale scale-5"></div>
                    </div>
                    
                    <!-- Плавники -->
                    <div class="fish-fin-top"></div>
                    <div class="fish-fin-bottom"></div>
                    
                    <!-- Глаз -->
                    <div class="fish-eye">
                        <div class="eye-sparkle"></div>
                    </div>
                </div>
                 <!-- Речевой пузырь -->
                <div class="speech-bubble">Загадай желание</div>
            </div>
        </div>
        <div class="global-click-hint">Лопните пузырьки</div>
    </div>

    <!-- Сцена 4: Фейерверк с поздравлением -->
    <div id="fireworkScene" class="scene-container">
        <div id="fireworkCanvas"></div>
        <button id="startButton" class="start-btn">🎉Нажми!</button>
        <audio id="explosionSound" preload="auto">
            <source src="firework.mp3" type="audio/mp3">
        </audio>
    </div>

    <script>
        // Глобальные переменные для управления сценами
        let currentScene = 0;
        const scenes = [
            'sunriseScene',
            'coffeeScene',
            'fishScene',
            'fireworkScene'
        ];
        
        // Переменные для игры с рыбкой
        let bubblesPopped = 0;
        let gameActive = true;
        const maxBubbles = 3;
        let bubbleInterval;
        
        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', () => {
            // Запускаем музыку
            const music = document.getElementById('backgroundMusic');
            music.volume = 0.7;
            
            // Пытаемся воспроизвести музыку
            const playMusic = () => {
                music.play().catch(e => {
                    console.log('Автозапуск музыки заблокирован, требуется взаимодействие пользователя');
                });
            };
            
            // Запускаем музыку при первом клике
            document.addEventListener('click', function musicStarter() {
                playMusic();
                document.removeEventListener('click', musicStarter);
            }, { once: true });
            
            // Инициализируем первую сцену
            initSunriseScene();
            
            // Назначаем обработчики событий
            setupEventListeners();
        });
        
        // Показать определенную сцену
        function showScene(index) {
            // Скрываем все сцены
            scenes.forEach(scene => {
                document.getElementById(scene).classList.remove('active');
            });
            
            // Показываем выбранную сцену
            document.getElementById(scenes[index]).classList.add('active');
            currentScene = index;
            
            // Инициализируем специфичные для сцены элементы
            if (index === 0) {
                initSunriseScene();
            } else if (index === 2) {
                initFishScene();
            } else if (index === 3) {
                initFireworkScene();
            }
        }
        
        // Переход к следующей сцене
        function nextScene() {
            // Анимация перехода
            document.body.style.animation = 'gentleFlash 0.8s ease-in-out';
            
            setTimeout(() => {
                document.body.style.animation = '';
                
                if (currentScene < scenes.length - 1) {
                    showScene(currentScene + 1);
                } else {
                    // Если это последняя сцена, начинаем сначала
                    showScene(0);
                }
            }, 800);
        }
        
        // Настройка обработчиков событий
        function setupEventListeners() {
            // Обработчик для волшебной палочки в сцене рассвета
            document.getElementById('magicWandSunrise').addEventListener('click', (e) => {
                e.stopPropagation();
                onWandClick(e);
            });
            
            // Обработчик для волшебной палочки в сцене кофе
            document.getElementById('magicWandCoffee').addEventListener('click', (e) => {
                e.stopPropagation();
                onWandClick(e);
            });
            
            // Обработчик для кнопки фейерверка
            document.getElementById('startButton').addEventListener('click', (e) => {
                e.stopPropagation();
                startAnimation();
                // Скрываем кнопку после нажатия
                document.getElementById('startButton').classList.add('hidden');
            });
        }
        
        // Инициализация сцены с рассветом
        function initSunriseScene() {
            const starsContainer = document.getElementById('stars');
            if (starsContainer) {
                starsContainer.innerHTML = '';
                
                const starCount = 150;
                
                for (let i = 0; i < starCount; i++) {
                    const star = document.createElement('div');
                    star.className = 'star';
                    
                    // Размер звезды
                    const size = Math.random() * 3 + 1;
                    star.style.width = size + 'px';
                    star.style.height = size + 'px';
                    
                    // Позиция
                    star.style.left = Math.random() * 100 + '%';
                    star.style.top = Math.random() * 80 + '%';
                    
                    // Анимация
                    star.style.animationDelay = Math.random() * 3 + 's';
                    star.style.animationDuration = (Math.random() * 2 + 2) + 's';
                    
                    starsContainer.appendChild(star);
                }
            }
            
            // Создание лучей солнца
            const raysContainer = document.getElementById('rays');
            if (raysContainer) {
                raysContainer.innerHTML = '';
                const rayCount = 16;
                
                for (let i = 0; i < rayCount; i++) {
                    const ray = document.createElement('div');
                    ray.className = 'ray';
                    
                    // Равномерное распределение лучей по кругу
                    const rotation = (360 / rayCount) * i;
                    ray.style.setProperty('--rotation', rotation + 'deg');
                    
                    // Разная длина лучей для естественности
                    ray.style.height = (180 + Math.random() * 40) + 'px';
                    ray.style.animationDelay = (Math.random() * 2) + 's';
                    
                    raysContainer.appendChild(ray);
                }
            }
            
            // Запускаем восход солнца
            const sunContainer = document.getElementById('sunContainer');
            const stars = document.getElementById('stars');
            
            if (sunContainer) {
                sunContainer.style.animation = 'sunrise 10s ease-out forwards';
            }
            if (stars) {
                stars.classList.add('fade-stars');
            }
        }
        
        // Обработчик клика по волшебной палочке
        function onWandClick(event) {
            // Воспроизводим звук
            const sound = document.getElementById('wandSound');
            sound.currentTime = 0;
            sound.play().catch(e => console.log('Автозапуск звука заблокирован'));
            
            // Анимация палочки с наклоном
            const wand = event.currentTarget;
            wand.style.animation = 'wandMagic 1s ease';
            
            // Создаем искры
            createSparks(wand);
            
            // Убираем анимацию после завершения
            setTimeout(() => {
                wand.style.animation = '';
            }, 800);
            
            // Переход к следующей сцене
            setTimeout(() => {
                nextScene();
            }, 1000);
        }
        
        // Создание искр для волшебной палочки
        function createSparks(wand) {
            const wandRect = wand.getBoundingClientRect();
            const tipPosition = {
                x: wandRect.left + wandRect.width / 2,
                y: wandRect.top
            };
            
            // Создаем 30 искр
            for (let i = 0; i < 100; i++) {
                setTimeout(() => createSpark(tipPosition), i * 100);
            }
        }
        
        function createSpark(tipPosition) {
            const spark = document.createElement('div');
            spark.className = 'spark';
            
            // Размер и цвет искры
            const size = Math.random() * 8 + 4;
            spark.style.width = size + 'px';
            spark.style.height = size + 'px';
            spark.style.background = getSparkColor();
            spark.style.borderRadius = '100%';
            spark.style.boxShadow = '0 0 8px currentColor';
            spark.style.position = 'absolute';
            spark.style.zIndex = '5';
            
            // Позиция начала (кончик палочки)
            spark.style.left = tipPosition.x + 'px';
            spark.style.top = tipPosition.y + 'px';
            
            // Траектория полета (вверх и в стороны)
            const angle = (Math.random() - 0.5) * Math.PI * 2;
            const distance = Math.random() * 100 + 50;
            
            const startX = 0;
            const startY = 0;
            const midX = Math.cos(angle) * distance * 0.4;
            const midY = Math.sin(angle) * distance * 0.4 - 30;
            const endX = Math.cos(angle) * distance;
            const endY = Math.sin(angle) * distance - 75;
            
            // Вращение искр
            const rotation = Math.random() * 360;
            const rotationEnd = rotation + Math.random() * 360;
            
            spark.style.setProperty('--startX', startX + 'px');
            spark.style.setProperty('--startY', startY + 'px');
            spark.style.setProperty('--midX', midX + 'px');
            spark.style.setProperty('--midY', midY + 'px');
            spark.style.setProperty('--endX', endX + 'px');
            spark.style.setProperty('--endY', endY + 'px');
            spark.style.setProperty('--rotate', rotation + 'deg');
            spark.style.setProperty('--rotateEnd', rotationEnd + 'deg');
            
            // Разная скорость анимации
            const duration = Math.random() * 1 + 0.5;
            spark.style.animation = `sparkFly ${duration}s ease-out forwards`;
            
            document.body.appendChild(spark);
            
            // Удаляем искру после завершения анимации
            setTimeout(() => {
                if (spark.parentNode) {
                    spark.parentNode.removeChild(spark);
                }
            }, duration * 1000);
        }
        
        function getSparkColor() {
            const colors = [
                '#ffdd00', '#ff6600', '#ff3300', '#ff0066', '#cc00ff', '#6600ff'
            ];
            return colors[Math.floor(Math.random() * colors.length)];
        }
        
        // Инициализация сцены с рыбкой
        function initFishScene() {
            // Сброс состояния игры
            bubblesPopped = 0;
            gameActive = true;
            
            // Очистка предыдущих пузырьков
            clearInterval(bubbleInterval);
            document.querySelectorAll('.bubble').forEach(bubble => bubble.remove());
            
            // Создание пузырьков
            createBubbles();
            
            // Показываем речевой пузырь с задержкой
            setTimeout(() => {
                const speechBubble = document.querySelector('.speech-bubble');
                if (speechBubble) {
                    speechBubble.style.opacity = '1';
                    
                    // Скрываем речевой пузырь через 5 секунд
                    setTimeout(() => {
                        speechBubble.style.opacity = '0';
                    }, 15000);
                }
            }, 2000);
            
            // Запускаем движение рыбки
            moveFish();
        }
        
        // Создание пузырьков для игры
        function createBubbles() {
            const aquarium = document.querySelector('.aquarium');
            if (!aquarium) return;
            
            bubbleInterval = setInterval(() => {
                if (!gameActive) return;
                
                const bubble = document.createElement('div');
                bubble.className = 'bubble';
                bubble.textContent = 'лопни';
                
                // Случайная позиция по горизонтали
                const leftPos = Math.random() * 95;
                bubble.style.left = `${leftPos}vw`;
                
                // Случайный размер
                const size = 30 + Math.random() * 60;
                bubble.style.width = `${size}px`;
                bubble.style.height = `${size}px`;
                
                // Случайная скорость
                const duration = 5 + Math.random() * 5;
                bubble.style.animationDuration = `${duration}s`;
                
                aquarium.appendChild(bubble);
                
                // Удаление пузырька после завершения анимации
                setTimeout(() => {
                    if (bubble.parentNode) {
                        bubble.parentNode.removeChild(bubble);
                    }
                }, duration * 1000);
                
                // Обработчик клика по пузырьку
                bubble.addEventListener('click', () => {
                    if (!gameActive) return;
                    
                    bubble.style.animation = 'none';
                    bubble.style.transition = 'transform 0.3s, opacity 0.3s';
                    bubble.style.transform = 'scale(2)';
                    bubble.style.opacity = '0';
                    
                    // Увеличиваем счетчик
                    bubblesPopped++;
                    
                    setTimeout(() => {
                        if (bubble.parentNode) {
                            bubble.parentNode.removeChild(bubble);
                        }
                        
                        // После 3 пузырьков переходим к следующей сцене
                        if (bubblesPopped >= maxBubbles) {
                            gameActive = false;
                            clearInterval(bubbleInterval);
                            setTimeout(() => nextScene(), 500);
                        }
                    }, 300);
                });
            }, 1000 + Math.random() * 2000);
        }
        
        // Движение рыбки
        function moveFish() {
            const fish = document.querySelector('.goldfish');
            if (!fish) return;
            
            let x = 50;
            let y = 50;
            let xSpeed = 0.1;
            let ySpeed = 0.15;
            let direction = 1;
            
            function animateFish() {
                // Обновляем позицию
                x += xSpeed;
                y += ySpeed;
                
                // Проверяем границы и меняем направление
                if (x > 95) {
                    xSpeed = -Math.abs(xSpeed);
                    direction = -1;
                } else if (x < 5) {
                    xSpeed = Math.abs(xSpeed);
                    direction = 1;
                }
                
                if (y > 90) {
                    ySpeed = -Math.abs(ySpeed);
                } else if (y < 10) {
                    ySpeed = Math.abs(ySpeed);
                }
                
                // Добавляем случайные изменения направления
                if (Math.random() < 0.01) {
                    xSpeed += (Math.random() - 0.5) * 0.1;
                    ySpeed += (Math.random() - 0.5) * 0.1;
                    
                    // Ограничиваем максимальную скорость
                    xSpeed = Math.max(Math.min(xSpeed, 0.4), -0.4);
                    ySpeed = Math.max(Math.min(ySpeed, 0.3), -0.3);
                }
                
                // Применяем новую позицию и направление
                fish.style.left = `${x}%`;
                fish.style.top = `${y}%`;
                fish.style.transform = `scaleX(${direction})`;
                
                // Продолжаем анимацию
                if (gameActive) {
                    requestAnimationFrame(animateFish);
                }
            }
            
            animateFish();
        }
        
        // Инициализация сцены с фейерверком
        function initFireworkScene() {
            // Убедитесь, что кнопка видна
            document.getElementById('startButton').classList.remove('hidden');
            
            // Очистите предыдущий canvas если есть
            const existingCanvas = document.querySelector('#fireworkScene canvas');
            if (existingCanvas) {
                existingCanvas.remove();
            }
        }
        
        // Запуск анимации фейерверка
        function startAnimation() {
            // Инициализация p5.js для фейерверка
            new p5(function(p) {
                let particles = [];
                let font;
                let message = "С днем рождения!";
                let letterX = [];
                let exploded = [];
                let explosionTimer = 0;
                let animationStarted = true;

                p.preload = function() {
                    // Можно загрузить дополнительные ресурсы здесь
                };

                p.setup = function() {
                    p.createCanvas(p.windowWidth, p.windowHeight);
                    p.colorMode(p.RGB);
                    
                    p.textFont("fantasy");
                    p.textAlign(p.CENTER, p.CENTER);
                    p.textSize(150);
                    
                    // Позиции букв
                    let textW = p.textWidth(message);
                    let startX = (p.width - textW) / 2;
                    
                    for (let i = 0; i < message.length; i++) {
                        let charW = p.textWidth(message.charAt(i));
                        letterX[i] = startX + p.textWidth(message.substring(0, i)) + charW / 2;
                        exploded[i] = false;
                    }
                    
                    // Запускаем первый взрыв
                    setTimeout(() => explodeNextLetter(), 500);
                };

                p.draw = function() {
                    if (!animationStarted) return;
                    
                    // Плавный полупрозрачный фон для следов
                    p.background(0, 30);
                    
                    // Рисуем невзорвавшиеся буквы
                    p.fill(198, 51, 252); // Ярко-розовый цвет букв
                    p.textSize(150);
                    for (let i = 0; i < message.length; i++) {
                        if (!exploded[i]) {
                            p.text(message.charAt(i), letterX[i], p.height/2 - 100);
                        }
                    }
                    
                    // Взрываем буквы по таймеру
                    explosionTimer++;
                    if (explosionTimer % 60 == 0) {
                        explodeNextLetter();
                    }
                    
                    // Обновляем частицы-сердечки
                    for (let i = particles.length - 1; i >= 0; i--) {
                        particles[i].update();
                        particles[i].display();
                        
                        if (particles[i].isDead()) {
                            particles.splice(i, 1);
                        }
                    }
                    
                    // Перезапуск через время
                    if (explosionTimer > 420 && particles.length === 0) {
                        resetAnimation();
                    }
                };

                function explodeNextLetter() {
                    for (let i = 0; i < message.length; i++) {
                        if (!exploded[i]) {
                            exploded[i] = true;
                            createExplosion(letterX[i], p.height/2 - 100);
                            playExplosionSound();
                            break;
                        }
                    }
                }

                function createExplosion(x, y) {
                    let heartColors = [
                        p.color(184, 0, 252), // Ярко-розовый
                        p.color(198, 51, 252),  // Глубокий розовый
                        p.color(219, 127, 252),   // Пурпурный
                        p.color(233, 181, 252),   // Золотой
                        p.color(255, 255, 255)  // Белый
                    ];
                    
                    for (let i = 0; i < 200; i++) {
                        let col = heartColors[i % heartColors.length];
                        particles.push(new HeartParticle(x, y, col));
                    }
                }

                function playExplosionSound() {
                    let sound = document.getElementById('explosionSound');
                    if (sound && sound.readyState >= 2) {
                        sound.currentTime = 0;
                        sound.play().catch(e => {
                            console.log('Ошибка воспроизведения звука:', e);
                        });
                    }
                }

                function resetAnimation() {
                    for (let i = 0; i < exploded.length; i++) {
                        exploded[i] = false;
                    }
                    explosionTimer = 0;
                    particles = [];
                    
                    // Перезапускаем автоматически
                    setTimeout(() => explodeNextLetter(), 1000);
                }

                class HeartParticle {
                    constructor(x, y, col) {
                        this.x = x;
                        this.y = y;
                        this.col = col;
                        this.life = 255;
                        this.size = p.random(15, 50);
                        
                        let speed = p.random(2, 6);
                        let angle = p.random(p.TWO_PI);
                        this.vx = p.cos(angle) * speed;
                        this.vy = p.sin(angle) * speed - p.random(1, 4);
                        
                        this.spin = p.random(-0.06, 0.06);
                        this.rotation = p.random(p.TWO_PI);
                    }
                    
                    update() {
                        this.vy += 0.08;
                        this.vx *= 0.98;
                        this.vy *= 0.98;
                        
                        this.x += this.vx;
                        this.y += this.vy;
                        this.rotation += this.spin;
                        
                        this.life -= 1.8;
                        this.size *= 0.988;
                    }
                    
                    display() {
                        let alpha = this.life;
                        if (alpha < 0) alpha = 0;
                        
                        p.push();
                        p.translate(this.x, this.y);
                        p.rotate(this.rotation);
                        
                        p.fill(p.red(this.col), p.green(this.col), p.blue(this.col), alpha);
                        p.noStroke();
                        
                        p.beginShape();
                        p.vertex(0, -this.size/3);
                        p.bezierVertex(
                            this.size/2, -this.size/1.5, 
                            this.size/1.2, -this.size/4, 
                            0, this.size/3
                        );
                        p.bezierVertex(
                            -this.size/1.2, -this.size/4, 
                            -this.size/2, -this.size/1.5, 
                            0, -this.size/3
                        );
                        p.endShape(p.CLOSE);
                        
                        p.pop();
                    }
                    
                    isDead() {
                        return this.life <= 0;
                    }
                }
            });
        }
    </script>
</body>

</html>
